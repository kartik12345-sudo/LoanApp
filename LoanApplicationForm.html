<!-- LoanApplicationForm.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Business Loan Application</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .form-input { @apply block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md; }
    .form-label { @apply text-sm font-medium text-gray-700; }
    .section-title { @apply text-xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200; }
    .message-box { @apply p-3 mb-4 rounded-md text-sm font-medium; }
    input { 
        border-color: aqua;
        @apply rounded border-gray-300 focus:ring-2 focus:ring-blue-500;
    }
  </style>
  <style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #f3f4f6;
  }

  input, select, textarea {
    width: 100%;
    padding: 0.5rem 1rem;
    margin-top: 0.25rem;
    border: 1px solid #d1d5db; /* Tailwind's gray-300 */
    border-radius: 0.375rem; /* rounded-md */
    font-size: 0.875rem;
    color: #374151; /* text-gray-700 */
  }

  label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151; /* text-gray-700 */
  }

  h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1f2937; /* text-gray-800 */
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
  }

  .message-box {
    padding: 0.75rem;
    margin-bottom: 1rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .success {
    background-color: #d1fae5; /* bg-green-100 */
    color: #065f46;            /* text-green-700 */
  }

  .error {
    background-color: #fee2e2; /* bg-red-100 */
    color: #991b1b;            /* text-red-700 */
  }

  button[type="submit"] {
    padding: 0.75rem 2rem;
    background-color: #2563eb; /* bg-blue-600 */
    color: white;
    font-weight: 600;
    border-radius: 0.375rem;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: background-color 0.3s ease;
    border: none;
    cursor: pointer;
  }

  button[type="submit"]:hover {
    background-color: #1d4ed8; /* bg-blue-700 */
  }

  textarea {
    resize: vertical;
  }
</style>

</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-4xl mx-auto bg-white shadow rounded-lg p-6">
    <h1 class="text-3xl font-bold text-center mb-4">Business Loan Application Form</h1>
    <div id="message-box" class="hidden message-box"></div>

    <form id="loan-application-form" onsubmit="submitForm(event)" class="space-y-8">
      <!-- SECTION: Company Information -->
      <div>
        <h2 class="section-title">1. Company Information</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div><label class="form-label">Company Legal Name</label><input name="company_name" required class="form-input"></div>
          <div><label class="form-label">Trade Name</label><input name="trade_name" class="form-input"></div>
          <div><label class="form-label">CIN/LLPIN</label><input name="registration_number" required class="form-input"></div>
          <div><label class="form-label">Date of Incorporation</label><input type="date" name="incorporation_date" required class="form-input"></div>
          <div class="md:col-span-2"><label class="form-label">Registered Address</label><textarea name="registered_address" rows="2" required class="form-input"></textarea></div>
          <div><label class="form-label">City</label><input name="city" required class="form-input"></div>
          <div><label class="form-label">State</label><input name="state" required class="form-input"></div>
          <div><label class="form-label">Zip Code</label><input name="zip_code" required class="form-input"></div>
          <div><label class="form-label">Country</label><input name="country" value="India" required class="form-input"></div>
          <div><label class="form-label">PAN</label><input name="company_pan" required class="form-input"></div>
          <div><label class="form-label">GSTIN</label><input name="company_gstin" required class="form-input"></div>
          <div><label class="form-label">Industry Type</label><input name="industry_type" required class="form-input"></div>
          <div><label class="form-label">Nature of Business</label><input name="business_activity" required class="form-input"></div>
        </div>
      </div>

      <!-- SECTION: Director 1 & 2 -->
      <div>
        <h2 class="section-title">2. Director Details (Minimum 2)</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div><label class="form-label">Director 1 Name</label><input name="director1_name" required class="form-input"></div>
          <div><label class="form-label">Director 1 PAN</label><input name="director1_pan" required class="form-input"></div>
          <div><label class="form-label">Director 1 Aadhaar</label><input name="director1_aadhar" required class="form-input"></div>
          <div><label class="form-label">Director 1 DIN</label><input name="director1_din" required class="form-input"></div>
          <div class="md:col-span-2"><label class="form-label">Director 1 Address</label><textarea name="director1_address" rows="2" required class="form-input"></textarea></div>

          <div><label class="form-label">Director 2 Name</label><input name="director2_name" required class="form-input"></div>
          <div><label class="form-label">Director 2 PAN</label><input name="director2_pan" required class="form-input"></div>
          <div><label class="form-label">Director 2 Aadhaar</label><input name="director2_aadhar" required class="form-input"></div>
          <div><label class="form-label">Director 2 DIN</label><input name="director2_din" required class="form-input"></div>
          <div class="md:col-span-2"><label class="form-label">Director 2 Address</label><textarea name="director2_address" rows="2" required class="form-input"></textarea></div>
        </div>
      </div>

      <!-- SECTION: Financial Information -->
      <div>
        <h2 class="section-title">3. Financial Information</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div><label class="form-label">Annual Revenue</label><input type="number" name="annual_revenue" required class="form-input"></div>
          <div><label class="form-label">PAT</label><input type="number" name="pat" required class="form-input"></div>
          <div><label class="form-label">Capital Employed</label><input type="number" name="capital_employed" required class="form-input"></div>
          <div><label class="form-label">Net Profit Margin (%)</label><input type="number" step="0.01" name="net_profit_margin" required class="form-input"></div>
          <div><label class="form-label">DSCR</label><input type="number" step="0.01" name="dscr" required class="form-input"></div>
          <div><label class="form-label">Current Asset to Liability</label><input type="number" step="0.01" name="current_asset_to_liability" required class="form-input"></div>
          <div><label class="form-label">Debt to Equity Ratio</label><input type="number" step="0.01" name="debt_to_equity" required class="form-input"></div>
          <div><label class="form-label">Bank Name</label><input name="bank_name" required class="form-input"></div>
          <div><label class="form-label">Bank Account Number</label><input name="bank_account_number" required class="form-input"></div>
          <div class="md:col-span-2"><label class="form-label">Existing Loans</label><textarea name="existing_loans" rows="2" class="form-input"></textarea></div>
        </div>
      </div>

      <!-- SECTION: Loan Requirement -->
      <div>
        <h2 class="section-title">4. Loan Requirement</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div><label class="form-label">Loan Amount</label><input type="number" name="loan_amount" required class="form-input"></div>
          <div><label class="form-label">Purpose</label><input name="loan_purpose" required class="form-input"></div>
          <div class="md:col-span-2"><label class="form-label">Other Purpose</label><textarea name="other_purpose" rows="2" class="form-input"></textarea></div>
          <div><label class="form-label">Repayment Period</label><input type="number" name="repayment_period" required class="form-input"></div>
          <div><label class="form-label">Collateral</label><input name="collateral" class="form-input"></div>
        </div>
      </div>

      <!-- SECTION: Declarations -->
      <div>
        <h2 class="section-title">5. Declarations</h2>
        <label><input type="checkbox" name="declaration1" required class="mr-2">Information is accurate</label><br>
        <label><input type="checkbox" name="declaration2" required class="mr-2">NBFC can verify information</label><br>
        <label><input type="checkbox" name="declaration3" required class="mr-2">Submission doesn't guarantee loan</label>
      </div>

      <!-- SUBMIT BUTTON -->
      <div class="text-center">
        <button class="bg-blue-600 text-white px-8 py-2 rounded hover:bg-blue-700">Submit Application</button>
      </div>
    </form>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBIIjb6cX-li0NghqRtZ0lzRE2IO4v4MoQ",
      authDomain: "loanappapi.firebaseapp.com",
      projectId: "loanappapi",
    };
    const appId = "default-app-id";
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUserId = null;
    onAuthStateChanged(auth, async (user) => {
      if (user) currentUserId = user.uid;
      else await signInAnonymously(auth);
    });

    async function getNextLoanNumber() {
      const snapshot = await getDocs(collection(db, `artifacts/${appId}/public/data/loanApplications`));
      return String(snapshot.size + 1).padStart(10, '0');
    }

    window.submitForm = async (e) => {
      e.preventDefault();
      if (!currentUserId) return;

      const form = document.getElementById('loan-application-form');
      const data = {};
      new FormData(form).forEach((val, key) => data[key] = val);
      data.loan_reference_number = `loan-applicationno-${await getNextLoanNumber()}`;
      data.submittedBy = currentUserId;
      data.submissionDate = new Date().toISOString();

      const box = document.getElementById('message-box');

      try {
        await addDoc(collection(db, `artifacts/${appId}/public/data/loanApplications`), data);
        form.reset();
        box.textContent = `Submitted! Ref No: ${data.loan_reference_number}`;
        box.className = "message-box bg-green-100 text-green-800";
        box.classList.remove("hidden");
      } catch (err) {
        console.error(err);
        box.textContent = "Error: " + err.message;
        box.className = "message-box bg-red-100 text-red-800";
        box.classList.remove("hidden");
      }
    }
  </script>
</body>
</html>
